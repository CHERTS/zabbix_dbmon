<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
   <version>5.0</version>
   <date>2020-12-28T07:03:13Z</date>
   <groups>
      <group>
         <name>Templates/Applications</name>
      </group>
   </groups>
   <templates>
      <template>
         <template>Template App Microsoft Exchange Server 2016 by Zabbix agent</template>
         <name>Template App Microsoft Exchange Server 2016 by Zabbix agent</name>
         <description>The template to monitor Microsoft Exchange Server 2016 by Zabbix that works without any external scripts.&#13;
The metrics are collected by Zabbix agent.&#13;
Recommended to use it with "OS Windows by Zabbix agent" template.&#13;
&#13;
&#13;
You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/415007-discussion-thread-for-official-zabbix-template-microsoft-exchange&#13;
&#13;
Template tooling version used: 0.38</description>
         <groups>
            <group>
               <name>Templates/Applications</name>
            </group>
         </groups>
         <applications>
            <application>
               <name>MS Exchange</name>
            </application>
         </applications>
         <items>
            <item>
               <name>MS Exchange: Databases total mounted</name>
               <key>perf_counter_en["\MSExchange Active Manager(_total)\Database Mounted"]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <description>Shows the number of active database copies on the server.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>3h</params>
                  </step>
               </preprocessing>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: ActiveSync: ping command pending</name>
               <key>perf_counter_en["\MSExchange ActiveSync\Ping Commands Pending", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of ping commands currently pending in the queue.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: ActiveSync: requests per second</name>
               <key>perf_counter_en["\MSExchange ActiveSync\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of HTTP requests received from the client via ASP.NET per second. Determines the current Exchange ActiveSync request rate. Used only to determine current user load.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: ActiveSync: sync commands per second</name>
               <key>perf_counter_en["\MSExchange ActiveSync\Sync Commands/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of sync commands processed per second. Clients use this command to synchronize items within a folder.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: Autodiscover: requests per second</name>
               <key>perf_counter_en["\MSExchangeAutodiscover\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of Autodiscover service requests processed each second. Determines current user load.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: Availability Service: availability requests per second</name>
               <key>perf_counter_en["\MSExchange Availability Service\Availability Requests (sec)", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of requests serviced per second. The request can be only for free/ busy information or include suggestions. One request may contain multiple mailboxes. Determines the rate at which Availability service requests are occurring.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: Outlook Web App: current unique users</name>
               <key>perf_counter_en["\MSExchange OWA\Current Unique Users", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of unique users currently logged on to Outlook Web App. This value monitors the number of unique active user sessions, so that users are only removed from this counter after they log off or their session times out. Determines current user load.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: Outlook Web App: requests per second</name>
               <key>perf_counter_en["\MSExchange OWA\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of requests handled by Outlook Web App per second. Determines current user load.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
            <item>
               <name>MS Exchange [Client Access Server]: MSExchangeWS: requests per second</name>
               <key>perf_counter_en["\MSExchangeWS\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>Shows the number of requests processed each second. Determines current user load.</description>
               <applications>
                  <application>
                     <name>MS Exchange</name>
                  </application>
               </applications>
            </item>
         </items>
         <discovery_rules>
            <discovery_rule>
               <name>LDAP discovery</name>
               <type>ZABBIX_PASSIVE</type>
               <key>perf_instance_en.discovery["MSExchange ADAccess Domain Controllers"]</key>
               <delay>1h</delay>
               <description>Discovery of domain controller.</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Domain Controller [{#INSTANCE}]: Read time</name>
                     <key>perf_counter_en["\MSExchange ADAccess Domain Controllers({#INSTANCE})\LDAP Read Time", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>Time that it takes to send an LDAP read request to the domain controller in question and get a response. Should ideally be below 50 ms; spikes below 100 ms are acceptable.</description>
                     <applications>
                        <application>
                           <name>MS Exchange</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.LDAP.TIME})}&gt;{$MS.EXCHANGE.LDAP.WARN}</expression>
                           <name>Domain Controller [{#INSTANCE}]: LDAP read time is too high (&gt;{$MS.EXCHANGE.LDAP.WARN}s for {$MS.EXCHANGE.LDAP.TIME})</name>
                           <priority>AVERAGE</priority>
                           <description>Should be less than 50ms at all times, with spikes less than 100ms.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Domain Controller [{#INSTANCE}]: Search time</name>
                     <key>perf_counter_en["\MSExchange ADAccess Domain Controllers({#INSTANCE})\LDAP Search Time", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>Time that it takes to send an LDAP search request and get a response. Should ideally be below 50 ms; spikes below 100 ms are acceptable.</description>
                     <applications>
                        <application>
                           <name>MS Exchange</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.LDAP.TIME})}&gt;{$MS.EXCHANGE.LDAP.WARN}</expression>
                           <name>Domain Controller [{#INSTANCE}]: LDAP search time is too high (&gt;{$MS.EXCHANGE.LDAP.WARN}s for {$MS.EXCHANGE.LDAP.TIME})</name>
                           <priority>AVERAGE</priority>
                           <description>Should be less than 50ms at all times, with spikes less than 100ms.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
               </item_prototypes>
               <host_prototypes/>
               <graph_prototypes>
                  <graph_prototype>
                     <name>Domain Controller [{#INSTANCE}]: Timings</name>
                     <graph_items>
                        <graph_item>
                           <color>1A7C11</color>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange ADAccess Domain Controllers({#INSTANCE})\LDAP Read Time", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>1</sortorder>
                           <color>2774A4</color>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange ADAccess Domain Controllers({#INSTANCE})\LDAP Search Time", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                     </graph_items>
                  </graph_prototype>
               </graph_prototypes>
            </discovery_rule>
            <discovery_rule>
               <name>Web services discovery</name>
               <type>ZABBIX_PASSIVE</type>
               <key>perf_instance_en.discovery["Web Service"]</key>
               <delay>1h</delay>
               <description>Discovery of Exchange web services.</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Web Service [{#INSTANCE}]: Current connections</name>
                     <key>perf_counter_en["\Web Service({#INSTANCE})\Current Connections", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Shows the current number of connections established to the each Web Service.</description>
                     <applications>
                        <application>
                           <name>MS Exchange</name>
                        </application>
                     </applications>
                  </item_prototype>
               </item_prototypes>
               <host_prototypes/>
            </discovery_rule>
            <discovery_rule>
               <name>Databases discovery</name>
               <type>ZABBIX_PASSIVE</type>
               <key>perf_instance.discovery["MSExchange Active Manager"]</key>
               <delay>1h</delay>
               <description>Discovery of Exchange databases.</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Active Manager [{#INSTANCE}]: Database copy role</name>
                     <key>perf_counter_en["\MSExchange Active Manager({#INSTANCE})\Database Copy Role Active"]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Database copy active or passive role.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <valuemap>
                        <name>Exchange database copy role</name>
                     </valuemap>
                     <preprocessing>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>3h</params>
                        </step>
                     </preprocessing>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: Page faults per second</name>
                     <key>perf_counter_en["\MSExchange Database({#INF.STORE})\Database Page Fault Stalls/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Indicates the rate of page faults that can't be serviced because there are no pages available for allocation from the database cache. If this counter is above 0, it's an indication that the MSExchange Database\I/O Database Writes (Attached) Average Latency is too high.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.DB.FAULTS.TIME})}&gt;{$MS.EXCHANGE.DB.FAULTS.WARN}</expression>
                           <name>Information Store [{#INSTANCE}]: Page faults is too high (&gt;{$MS.EXCHANGE.DB.FAULTS.WARN} for {$MS.EXCHANGE.DB.FAULTS.TIME})</name>
                           <priority>AVERAGE</priority>
                           <description>Too much page faults stalls for database "{#INSTANCE}". This counter should be 0 on production servers.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: Log records stalled</name>
                     <key>perf_counter_en["\MSExchange Database({#INF.STORE})\Log Record Stalls/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Indicates the number of log records that can't be added to the log buffers per second because the log buffers are full. The average value should be below 10 per second. Spikes (maximum values) shouldn't be higher than 100 per second.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{avg({$MS.EXCHANGE.LOG.STALLS.TIME})}&gt;{$MS.EXCHANGE.LOG.STALLS.WARN}</expression>
                           <name>Information Store [{#INSTANCE}]: Log records stalls is too high (&gt;{$MS.EXCHANGE.LOG.STALLS.WARN} for {$MS.EXCHANGE.LOG.STALLS.TIME})</name>
                           <priority>AVERAGE</priority>
                           <description>Stalled log records too high. The average value should be less than 10 threads waiting.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: Log threads waiting</name>
                     <key>perf_counter_en["\MSExchange Database({#INF.STORE})\Log Threads Waiting", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Indicates the number of threads waiting to complete an update of the database by writing their data to the log.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Database Counters [{#INSTANCE}]: Active database read operations per second</name>
                     <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Attached)/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Shows the number of database read operations.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Database Counters [{#INSTANCE}]: Active database read operations latency</name>
                     <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Attached) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>Shows the average length of time per database read operation. Should be less than 20 ms on average.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.DB.ACTIVE.READ.TIME})}&gt;{$MS.EXCHANGE.DB.ACTIVE.READ.WARN}</expression>
                           <name>Database Counters [{#INSTANCE}]: Average read time latency is too high (&gt;{$MS.EXCHANGE.DB.ACTIVE.READ.WARN}s for {$MS.EXCHANGE.DB.ACTIVE.READ.TIME})</name>
                           <priority>WARNING</priority>
                           <description>Should be less than 20ms on average.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Database Counters [{#INSTANCE}]: Passive database read operations latency</name>
                     <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Recovery) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>Shows the average length of time per passive database read operation. Should be less than 200ms on average.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.DB.PASSIVE.READ.TIME})}&gt;{$MS.EXCHANGE.DB.PASSIVE.READ.WARN}</expression>
                           <name>Database Counters [{#INSTANCE}]: Average read time latency is too high (&gt;{$MS.EXCHANGE.DB.PASSIVE.READ.WARN}s for {$MS.EXCHANGE.DB.PASSIVE.READ.TIME})</name>
                           <priority>WARNING</priority>
                           <description>Should be less than 200ms on average.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Database Counters [{#INSTANCE}]: Active database write operations per second</name>
                     <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Attached)/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Shows the number of database write operations per second for each attached database instance.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Database Counters [{#INSTANCE}]: Active database write operations latency</name>
                     <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Attached) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>Shows the average length of time per database write operation. Should be less than 50ms on average.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.DB.ACTIVE.WRITE.TIME})}&gt;{$MS.EXCHANGE.DB.ACTIVE.WRITE.WARN}</expression>
                           <name>Database Counters [{#INSTANCE}]: Average write time latency is too high for {$MS.EXCHANGE.DB.ACTIVE.WRITE.TIME}</name>
                           <priority>WARNING</priority>
                           <description>Should be less than 50ms on average.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Database Counters [{#INSTANCE}]: Passive database write operations latency</name>
                     <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Recovery) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>Shows the average length of time, in ms, per passive database write operation. Should be less than the read latency for the same instance, as measured by the MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Recovery) Average Latency counter.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: Active mailboxes count</name>
                     <key>perf_counter_en["\MSExchangeIS Store({#INSTANCE})\Active mailboxes"]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Number of active mailboxes in this database.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: Database state</name>
                     <key>perf_counter_en["\MSExchangeIS Store({#INSTANCE})\Database State"]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Database state. Possible values:&#13;
0: Database without any copy and dismounted.&#13;
1: Database is a primary database and mounted.&#13;
2: Database is a passive copy and the state is healthy.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <valuemap>
                        <name>Exchange database state</name>
                     </valuemap>
                     <preprocessing>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>3m</params>
                        </step>
                     </preprocessing>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: RPC requests latency</name>
                     <key>perf_counter_en["\MSExchangeIS Store({#INSTANCE})\RPC Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>s</units>
                     <description>RPC Latency average is the average latency of RPC requests per database. Average is calculated over all RPCs since exrpc32 was loaded. Should be less than 50ms at all times, with spikes less than 100ms.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.RPC.TIME})}&gt;{$MS.EXCHANGE.RPC.WARN}</expression>
                           <name>Information Store [{#INSTANCE}]: RPC Requests latency is too high (&gt;{$MS.EXCHANGE.RPC.WARN}s for {$MS.EXCHANGE.RPC.TIME})</name>
                           <priority>WARNING</priority>
                           <description>Should be less than 50ms at all times, with spikes less than 100ms.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: RPC requests per second</name>
                     <key>perf_counter_en["\MSExchangeIS Store({#INSTANCE})\RPC Operations/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Shows the number of RPC operations per second for each database instance.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Information Store [{#INSTANCE}]: RPC requests total</name>
                     <key>perf_counter_en["\MSExchangeIS Store({#INSTANCE})\RPC requests", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                     <delay>{$MS.EXCHANGE.PERF.INTERVAL}</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <description>Indicates the overall RPC requests currently executing within the information store process. Should be below 70 at all times.</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Database {#INSTANCE}</name>
                        </application_prototype>
                     </application_prototypes>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min({$MS.EXCHANGE.RPC.COUNT.TIME})}&gt;{$MS.EXCHANGE.RPC.COUNT.WARN}</expression>
                           <name>Information Store [{#INSTANCE}]: RPC Requests total count is too high (&gt;{$MS.EXCHANGE.RPC.COUNT.WARN} for {$MS.EXCHANGE.RPC.COUNT.TIME})</name>
                           <priority>WARNING</priority>
                           <description>Should be below 70 at all times.</description>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
               </item_prototypes>
               <host_prototypes/>
               <trigger_prototypes>
                  <trigger_prototype>
                     <expression>{Template App Microsoft Exchange Server 2016 by Zabbix agent:perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Recovery) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}].avg({$MS.EXCHANGE.DB.PASSIVE.WRITE.TIME})}&gt;{Template App Microsoft Exchange Server 2016 by Zabbix agent:perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Recovery) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}].avg({$MS.EXCHANGE.DB.PASSIVE.WRITE.TIME})}</expression>
                     <name>Database Counters [{#INSTANCE}]: Average write time latency is higher than read time latency for {$MS.EXCHANGE.DB.PASSIVE.WRITE.TIME}</name>
                     <priority>WARNING</priority>
                     <description>Should be less than the read latency for the same instance, as measured by the MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Recovery) Average Latency counter.</description>
                  </trigger_prototype>
               </trigger_prototypes>
               <graph_prototypes>
                  <graph_prototype>
                     <name>Database Counters [{#INSTANCE}]: Read and write stats</name>
                     <graph_items>
                        <graph_item>
                           <color>1A7C11</color>
                           <yaxisside>RIGHT</yaxisside>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Attached)/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>1</sortorder>
                           <color>2774A4</color>
                           <yaxisside>RIGHT</yaxisside>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Attached)/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>2</sortorder>
                           <color>F63100</color>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Attached) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>3</sortorder>
                           <color>A54F10</color>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Reads (Recovery) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>4</sortorder>
                           <color>FC6EA3</color>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Attached) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>5</sortorder>
                           <color>6C59DC</color>
                           <item>
                              <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                              <key>perf_counter_en["\MSExchange Database ==&gt; Instances({#INF.STORE}/_Total)\I/O Database Writes (Recovery) Average Latency", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
                           </item>
                        </graph_item>
                     </graph_items>
                  </graph_prototype>
               </graph_prototypes>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>var data = JSON.parse(value);

data.forEach(function(instance) {
    if (instance["{#INSTANCE}"] === '_total') {
        instance["{#INF.STORE}"] = 'Information Store';
    }
    else {
        instance["{#INF.STORE}"] = 'Information Store - ' + instance["{#INSTANCE}"];
    }
})

return JSON.stringify(data);</params>
                  </step>
               </preprocessing>
            </discovery_rule>
         </discovery_rules>
         <macros>
            <macro>
               <macro>{$MS.EXCHANGE.DB.ACTIVE.READ.TIME}</macro>
               <value>5m</value>
               <description>The time during which the active database read operations latency may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.ACTIVE.READ.WARN}</macro>
               <value>0.02</value>
               <description>Threshold for active database read operations latency trigger.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.ACTIVE.WRITE.TIME}</macro>
               <value>10m</value>
               <description>The time during which the active database write operations latency may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.ACTIVE.WRITE.WARN}</macro>
               <value>0.05</value>
               <description>Threshold for active database write operations latency trigger.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.FAULTS.TIME}</macro>
               <value>5m</value>
               <description>The time during which the database page faults may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.FAULTS.WARN}</macro>
               <value>0</value>
               <description>Threshold for database page faults trigger.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.PASSIVE.READ.TIME}</macro>
               <value>5m</value>
               <description>The time during which the passive database read operations latency may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.PASSIVE.READ.WARN}</macro>
               <value>0.2</value>
               <description>Threshold for passive database read operations latency trigger.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.DB.PASSIVE.WRITE.TIME}</macro>
               <value>10m</value>
               <description>The time during which the passive database write operations latency may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.LDAP.TIME}</macro>
               <value>5m</value>
               <description>The time during which the LDAP metrics may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.LDAP.WARN}</macro>
               <value>0.05</value>
               <description>Threshold for LDAP triggers.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.LOG.STALLS.TIME}</macro>
               <value>10m</value>
               <description>The time during which the log records stalled may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.LOG.STALLS.WARN}</macro>
               <value>100</value>
               <description>Threshold for log records stalled trigger.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.PERF.INTERVAL}</macro>
               <value>60</value>
               <description>Update interval for perf_counter_en items.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.RPC.COUNT.TIME}</macro>
               <value>5m</value>
               <description>The time during which the RPC total requests may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.RPC.COUNT.WARN}</macro>
               <value>70</value>
               <description>Threshold for LDAP triggers.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.RPC.TIME}</macro>
               <value>10m</value>
               <description>The time during which the RPC requests latency may exceed the threshold.</description>
            </macro>
            <macro>
               <macro>{$MS.EXCHANGE.RPC.WARN}</macro>
               <value>0.05</value>
               <description>Threshold for RPC requests latency trigger.</description>
            </macro>
         </macros>
      </template>
   </templates>
   <graphs>
      <graph>
         <name>MS Exchange [Client Access Server]: Request rate</name>
         <graph_items>
            <graph_item>
               <color>1A7C11</color>
               <item>
                  <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                  <key>perf_counter_en["\MSExchange ActiveSync\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <color>2774A4</color>
               <item>
                  <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                  <key>perf_counter_en["\MSExchange Availability Service\Availability Requests (sec)", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>2</sortorder>
               <color>F63100</color>
               <item>
                  <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                  <key>perf_counter_en["\MSExchange OWA\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>3</sortorder>
               <color>A54F10</color>
               <item>
                  <host>Template App Microsoft Exchange Server 2016 by Zabbix agent</host>
                  <key>perf_counter_en["\MSExchangeWS\Requests/sec", {$MS.EXCHANGE.PERF.INTERVAL}]</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
   </graphs>
   <value_maps>
      <value_map>
         <name>Service state</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>Down</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Up</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Exchange database copy role</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>Passive</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Active</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Exchange database state</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>Dismounted</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Mounted</newvalue>
            </mapping>
            <mapping>
               <value>2</value>
               <newvalue>Healthy</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Windows service state</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>Running</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Paused</newvalue>
            </mapping>
            <mapping>
               <value>2</value>
               <newvalue>Start pending</newvalue>
            </mapping>
            <mapping>
               <value>3</value>
               <newvalue>Pause pending</newvalue>
            </mapping>
            <mapping>
               <value>4</value>
               <newvalue>Continue pending</newvalue>
            </mapping>
            <mapping>
               <value>5</value>
               <newvalue>Stop pending</newvalue>
            </mapping>
            <mapping>
               <value>6</value>
               <newvalue>Stopped</newvalue>
            </mapping>
            <mapping>
               <value>7</value>
               <newvalue>Unknown</newvalue>
            </mapping>
            <mapping>
               <value>255</value>
               <newvalue>No such service</newvalue>
            </mapping>
         </mappings>
      </value_map>
   </value_maps>
</zabbix_export>
