<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>4.4</version>
    <date>2020-01-22T08:04:41Z</date>
    <groups>
        <group>
            <name>DBS.Templates</name>
        </group>
        <group>
            <name>DBS.Templates/Databases</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>DBS_Template MySQL</template>
            <name>DBS_Template MySQL</name>
            <groups>
                <group>
                    <name>DBS.Templates</name>
                </group>
                <group>
                    <name>DBS.Templates/Databases</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>DBS MySQL</name>
                </application>
                <application>
                    <name>stubs</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Check zabbix-server result</name>
                    <type>TRAP</type>
                    <key>dbs.runshell[dbs_check_zabbix_server,mysql,result]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>{$DBS_MYSQL_SHORT_TRENDS}</trends>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>DBS Check active zabbix server (MySQL)</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>dbs.runshell[dbs_check_zabbix_server,mysql]</key>
                    <delay>{$DBS_MYSQL_ZABBIX_CHECK_TIME}</delay>
                    <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>stubs</name>
                        </application>
                    </applications>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>Local date (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,date]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.date</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>Number of running DBS script (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,dbs_zbx_mon_processes_number]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_MEDIUM_HISTORY}</history>
                    <trends>{$DBS_MYSQL_MEDIUM_TRENDS}</trends>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.dbs_zbx_mon_processes_number</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                    <triggers>
                        <trigger>
                            <expression>{avg(7m)}&gt;={$DBS_MYSQL_MAX_RUNNING_DBS_SCRIPT}</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{max(5m)}&lt;{$DBS_MYSQL_MAX_RUNNING_DBS_SCRIPT}</recovery_expression>
                            <name>Number of running DBS script is too high</name>
                            <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_MAX_RUNNING_DBS_SCRIPT}, alert started: {ITEM.VALUE1})</opdata>
                            <priority>WARNING</priority>
                            <description>Аларм указывает, что общее количество одновременно запущенных скриптов мониторинга БД, выполняющих разные задачи, слишком велико. Возможно скрипты мониторинга стали отрабатывать долго и висят запущенными в памяти. Причиной долгого выполнения скриптов так же могут служить проблемы на сервере или в БД. Необходимо проверить сервер и БД на предмет проблем.</description>
                            <dependencies>
                                <dependency>
                                    <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                                    <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].last()}&lt;&gt;1 or {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>Service</tag>
                                    <value>DBS-MySQL-Heartbeat</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Debug mode (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,debug]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>{$DBS_MYSQL_SHORT_TRENDS}</trends>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>DBS Oracle Script (yes_no)</name>
                    </valuemap>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.debug</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>Hostname (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,hostname]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.hostname</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>License expire (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,license_expire]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>{$DBS_MYSQL_SHORT_TRENDS}</trends>
                    <units>s</units>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.license_expire</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;3d</expression>
                            <name>DBS license to monitor Oracle expires in less than 3 days</name>
                            <opdata>(expire: {ITEM.LASTVALUE})</opdata>
                            <priority>WARNING</priority>
                            <description>Аларм указывает на то, что менее чем через 3 дня скрипты мониторинга перестанут отправлять на zabbix-server данные мониторинга из-за лицензионных ограничений. Необходимо обратиться к Михаилу Григорьеву для продления лицензии на мониторинг БД.</description>
                            <dependencies>
                                <dependency>
                                    <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                                    <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].last()}&lt;&gt;1 or {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>Service</tag>
                                    <value>DBS-MySQL-Heartbeat</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Script SHA256 checksum (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,script_crc]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.script_crc</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>Script version (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,script_version]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_MEDIUM_HISTORY}</history>
                    <trends>{$DBS_MYSQL_MEDIUM_TRENDS}</trends>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.script_version</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                    <triggers>
                        <trigger>
                            <expression>{diff()}=1</expression>
                            <recovery_mode>NONE</recovery_mode>
                            <name>DBS script has been updated.</name>
                            <priority>INFO</priority>
                            <description>Произошло обновление скриптов мониторинга в ручном режиме. Уточнить в дежурном чате про запуск ручного обновления скриптов мониторинга.</description>
                            <type>MULTIPLE</type>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>Service</tag>
                                    <value>DBS-MySQL-Heartbeat</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Zabbix active server (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,zabbix_active_server]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.zabbix_active_server</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>PID of zabbix_agent(d) running (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_pid]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>{$DBS_MYSQL_SHORT_TRENDS}</trends>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.zabbix_agentd_pid</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                    <triggers>
                        <trigger>
                            <expression>{diff()}=1</expression>
                            <name>Zabbix agent has just been restarted.</name>
                            <priority>INFO</priority>
                            <description>Zabbix-агент был перезапущен. Перезапуск может быть как в результате перезапуска всего сервера, так и конкретно одной службы. Проверить uptime сервера, проверить работу zabbix-агента, уточнить в дежурном чате кто осуществил перезапуск агента.</description>
                            <dependencies>
                                <dependency>
                                    <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                                    <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].last()}&lt;&gt;1 or {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>Service</tag>
                                    <value>DBS-MySQL-Heartbeat</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Agent ping (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>{$DBS_MYSQL_SHORT_TRENDS}</trends>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>DBS Zabbix Agent status</name>
                    </valuemap>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.zabbix_agentd_ping</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                    <triggers>
                        <trigger>
                            <expression>{nodata({$DBS_MYSQL_AGENTD_NODATA_CRIT})}=1</expression>
                            <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_CRIT} (minutes).</name>
                            <priority>DISASTER</priority>
                            <description>Аларм указывает на то, что от скриптом мониторинга давно не приходили данные самодиагностики (heartbeat). Необходимо проверить сервер на наличие проблем. Первым признаком появления данного аларма может служить остановка zabbix-агента или его неустойчивая работа, критические проблемы на сервере, сетевые проблемы.</description>
                            <tags>
                                <tag>
                                    <tag>Service</tag>
                                    <value>DBS-MySQL-Heartbeat</value>
                                </tag>
                            </tags>
                        </trigger>
                        <trigger>
                            <expression>{last()}&lt;&gt;1 or {nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                            <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                            <priority>AVERAGE</priority>
                            <description>Аларм указывает на то, что от скриптом мониторинга давно не приходили данные самодиагностики (heartbeat). Необходимо проверить сервер на наличие проблем. Первым признаком появления данного аларма может служить остановка zabbix-агента или его неустойчивая работа, критические проблемы на сервере, сетевые проблемы.</description>
                            <dependencies>
                                <dependency>
                                    <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_CRIT} (minutes).</name>
                                    <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_CRIT})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>Service</tag>
                                    <value>DBS-MySQL-Heartbeat</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Version of zabbix_agent(d) running (DBS)</name>
                    <type>DEPENDENT</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_version]</key>
                    <delay>0</delay>
                    <history>{$DBS_MYSQL_SHORT_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>DBS MySQL</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <params>$.zabbix_agentd_version</params>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    </master_item>
                    <request_method>POST</request_method>
                </item>
                <item>
                    <name>DBS Heartbeat (MySQL)</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>dbs.runshell[dbs_heartbeat,mysql]</key>
                    <delay>{$DBS_MYSQL_HEARTBEAT_CHECK_TIME}</delay>
                    <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>stubs</name>
                        </application>
                    </applications>
                    <request_method>POST</request_method>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>MySQL database discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>dbs.runshell[db_discovery,mysql]</key>
                    <delay>{$DBS_MYSQL_LLD_DB_TIME}</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#DBNAME}</macro>
                                <value>^(?!(mysql|sys|test|information_schema|performance_schema|.*lost\+found)$).*$</value>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <item_prototypes>
                        <item_prototype>
                            <name>[MySQL] DB '{#DBNAME}': Size</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.db[{#INSTANCE},{#DBNAME},size]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}:{#DBNAME}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}:{#DBNAME}&quot;}</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, DB: {#DBNAME}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$DBS_MYSQL_DBSIZE_CRIT:&quot;{#DBNAME}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}&lt;={$DBS_MYSQL_DBSIZE_CRIT:&quot;{#DBNAME}&quot;}</recovery_expression>
                                    <name>Size of database '{#DBNAME}' has increased</name>
                                    <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_DBSIZE_CRIT:&quot;{#DBNAME}&quot;}, alert started: {ITEM.VALUE1})</opdata>
                                    <priority>AVERAGE</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>Database '{#DBNAME}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].max(#5)}=2 or {DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].nodata({$DBS_MYSQL_DB_NODATA_WARN:&quot;{#DBNAME}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].last()}=1</recovery_expression>
                                        </dependency>
                                        <dependency>
                                            <name>Size of database '{#DBNAME}' has increased</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},size].last()}&gt;{$DBS_MYSQL_DBSIZE_DISAS:&quot;{#DBNAME}&quot;}</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},size].last()}&lt;={$DBS_MYSQL_DBSIZE_DISAS:&quot;{#DBNAME}&quot;}</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>Database</tag>
                                            <value>{#DBNAME}</value>
                                        </tag>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$DBS_MYSQL_DBSIZE_DISAS:&quot;{#DBNAME}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}&lt;={$DBS_MYSQL_DBSIZE_DISAS:&quot;{#DBNAME}&quot;}</recovery_expression>
                                    <name>Size of database '{#DBNAME}' has increased</name>
                                    <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_DBSIZE_DISAS:&quot;{#DBNAME}&quot;}, alert started: {ITEM.VALUE1})</opdata>
                                    <priority>HIGH</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>Database '{#DBNAME}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].max(#5)}=2 or {DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].nodata({$DBS_MYSQL_DB_NODATA_WARN:&quot;{#DBNAME}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>Database</tag>
                                            <value>{#DBNAME}</value>
                                        </tag>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$DBS_MYSQL_DBSIZE_WARN:&quot;{#DBNAME}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}&lt;={$DBS_MYSQL_DBSIZE_WARN:&quot;{#DBNAME}&quot;}</recovery_expression>
                                    <name>Size of database '{#DBNAME}' has increased</name>
                                    <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_DBSIZE_WARN:&quot;{#DBNAME}&quot;}, alert started: {ITEM.VALUE1})</opdata>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>Database '{#DBNAME}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].max(#5)}=2 or {DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].nodata({$DBS_MYSQL_DB_NODATA_WARN:&quot;{#DBNAME}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].last()}=1</recovery_expression>
                                        </dependency>
                                        <dependency>
                                            <name>Size of database '{#DBNAME}' has increased</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},size].last()}&gt;{$DBS_MYSQL_DBSIZE_CRIT:&quot;{#DBNAME}&quot;}</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},size].last()}&lt;={$DBS_MYSQL_DBSIZE_CRIT:&quot;{#DBNAME}&quot;}</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>Database</tag>
                                            <value>{#DBNAME}</value>
                                        </tag>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] DB '{#DBNAME}': Status</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.db[{#INSTANCE},{#DBNAME},status]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}:{#DBNAME}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}:{#DBNAME}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, DB: {#DBNAME}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <valuemap>
                                <name>DBS MySQL (Database access state)</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{max(#3)}=0</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}=1</recovery_expression>
                                    <name>Database '{#DBNAME}' access failed.</name>
                                    <priority>HIGH</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                                            <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].last()}&lt;&gt;1 or {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>Database</tag>
                                            <value>{#DBNAME}</value>
                                        </tag>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{max(#5)}=2 or {nodata({$DBS_MYSQL_DB_NODATA_WARN:&quot;{#DBNAME}&quot;})}=1</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}=1</recovery_expression>
                                    <name>Database '{#DBNAME}' is not available.</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>Database '{#DBNAME}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].max(#10)}=2 or {DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].nodata({$DBS_MYSQL_DB_NODATA_CRIT:&quot;{#DBNAME}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.db[{#INSTANCE},{#DBNAME},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>Database</tag>
                                            <value>{#DBNAME}</value>
                                        </tag>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{max(#10)}=2 or {nodata({$DBS_MYSQL_DB_NODATA_CRIT:&quot;{#DBNAME}&quot;})}=1</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}=1</recovery_expression>
                                    <name>Database '{#DBNAME}' is not available.</name>
                                    <priority>HIGH</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                                            <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].last()}&lt;&gt;1 or {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>Database</tag>
                                            <value>{#DBNAME}</value>
                                        </tag>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.db_info[{#INSTANCE},{#DBNAME}]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[db_info,mysql,{#INSTANCE},{#DBNAME}]</key>
                            <delay>{$DBS_MYSQL_DB_INFO_TIME:&quot;{#INSTANCE}:{#DBNAME}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.db_size[{#INSTANCE},{#DBNAME}]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[db_size,mysql,{#INSTANCE},{#DBNAME}]</key>
                            <delay>{$DBS_MYSQL_DBSIZE_INFO_TIME:&quot;{#INSTANCE}:{#DBNAME}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>MySQL instance discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>dbs.runshell[instance_discovery,mysql]</key>
                    <delay>{$DBS_MYSQL_LLD_INSTANCE_TIME}</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}' backup: Last full database backup</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.backup[{#INSTANCE},database_full]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Backup</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$DBS_MYSQL_FULL_BACKUP_CRIT:&quot;{#INSTANCE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}&lt;={$DBS_MYSQL_FULL_BACKUP_CRIT:&quot;{#INSTANCE}&quot;}</recovery_expression>
                                    <name>No full database backups</name>
                                    <opdata>(last: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_FULL_BACKUP_CRIT:&quot;{#INSTANCE}&quot;})</opdata>
                                    <priority>HIGH</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}&gt;{$DBS_MYSQL_FULL_BACKUP_WARN:&quot;{#INSTANCE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}&lt;={$DBS_MYSQL_FULL_BACKUP_WARN:&quot;{#INSTANCE}&quot;}</recovery_expression>
                                    <name>No full database backups</name>
                                    <opdata>(last: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_FULL_BACKUP_WARN:&quot;{#INSTANCE}&quot;})</opdata>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                        <dependency>
                                            <name>No full database backups</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.backup[{#INSTANCE},database_full].last()}&gt;{$DBS_MYSQL_FULL_BACKUP_CRIT:&quot;{#INSTANCE}&quot;}</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.backup[{#INSTANCE},database_full].last()}&lt;={$DBS_MYSQL_FULL_BACKUP_CRIT:&quot;{#INSTANCE}&quot;}</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}' backup: Last full database backup (duration)</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.backup[{#INSTANCE},database_full_duration]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Backup</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}' backup: Last full database backup (size)</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.backup[{#INSTANCE},database_full_size]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Backup</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}' backup: Last incremental database backup</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.backup[{#INSTANCE},database_incr]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Backup</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}' backup: Last incremental database backup (duration)</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.backup[{#INSTANCE},database_incr_duration]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Backup</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}' backup: Last incremental database backup (size)</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.backup[{#INSTANCE},database_incr_size]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Backup</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}': Startup time</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.instance[{#INSTANCE},startup_time]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_MEDIUM_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>unixtime</units>
                            <description>Время запуска mysqld</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}': Status</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.instance[{#INSTANCE},status]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <description>Статус MySQL:&#13;
0 - STOPPED&#13;
1 - RUNNING&#13;
2 - BACKUPING&#13;
3 - RESTORING&#13;
4 - ERROR</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <valuemap>
                                <name>DBS MySQL (Instance state)</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=0 or {nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}=1</recovery_expression>
                                    <name>Instance '{#INSTANCE}' is not available.</name>
                                    <priority>DISASTER</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>DBS script is unreachable for more {$DBS_MYSQL_AGENTD_NODATA_WARN} (minutes).</name>
                                            <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].last()}&lt;&gt;1 or {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,zabbix_agentd_ping].nodata({$DBS_MYSQL_AGENTD_NODATA_WARN})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}=2</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}=1</recovery_expression>
                                    <name>Instance '{#INSTANCE}' is now running hotbackup.</name>
                                    <status>DISABLED</status>
                                    <priority>INFO</priority>
                                    <description>Запущена процедура создания горячей резервной копии.</description>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{last()}=3</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{last()}=1</recovery_expression>
                                    <name>Now running restoring instance '{#INSTANCE}'.</name>
                                    <priority>INFO</priority>
                                    <description>Запущена процедура восстановления из горячей резервной копии.</description>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance '{#INSTANCE}': UUID</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.instance[{#INSTANCE},uuid]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Instance  '{#INSTANCE}': Version</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.instance[{#INSTANCE},version]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Версия MySQL.</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>^([0-9]+.[0-9]+.[0-9]+)
\1</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Version of MySQL has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <description>Аларм указывает на то, что произошла смена версии MySQL. Необходимо проверить в истории какая была раньше версия и какая сейчас. Если смена версии действительно произошла, то уточнить в чате о работах по обновлению MySQL.</description>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status: Open tables</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.status[{#INSTANCE},open_tables]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status: Threads - Cached</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.status[{#INSTANCE},threads_cached]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status: Threads - Connected</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.status[{#INSTANCE},threads_connected]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status: Threads - Created</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.status[{#INSTANCE},threads_created]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status: Threads - Running</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.status[{#INSTANCE},threads_running]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status '{#INSTANCE}': Uptime</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.status[{#INSTANCE},uptime]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>s</units>
                            <description>Общее время работы mysqld с момента запуска.</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{change()}&lt;-5</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Instance '{#INSTANCE}' has just been restarted</name>
                                    <opdata>(current uptime: {ITEM.LASTVALUE}, alert started: {ITEM.VALUE})</opdata>
                                    <priority>DISASTER</priority>
                                    <description>Процесс mysqld был перезапущен. Необходимо проверить факт перезапуска на сервере, проверить логи, далее уточнить в чате кто произвел перезапуск. Возможно, что перезапуск произошел в результате краха процесса в автоматическом режиме.</description>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Variable: Max connections</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},max_connections]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <description>Максимально допустимое число клиентских соединений</description>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Variable: Table open cache</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},table_open_cache]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.backup_info[{#INSTANCE},full]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[backup_info,mysql,{#INSTANCE}]</key>
                            <delay>{$DBS_MYSQL_BACKUP_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.instance_info[{#INSTANCE},full]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[instance_info,mysql,{#INSTANCE}]</key>
                            <delay>{$DBS_MYSQL_INSTANCE_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.status_info[{#INSTANCE},threads_info]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[status_info,mysql,{#INSTANCE},,,,,&quot;Threads%&quot;]</key>
                            <delay>{$DBS_MYSQL_THREADS_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.status_info[{#INSTANCE},open_tables]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[status_info,mysql,{#INSTANCE},,,,,open_tables]</key>
                            <delay>{$DBS_MYSQL_STATUS_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.status_info[{#INSTANCE},uptime]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[status_info,mysql,{#INSTANCE},,,,,uptime]</key>
                            <delay>{$DBS_MYSQL_STATUS_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.variable_info[{#INSTANCE},max_connections]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[variable_info,mysql,{#INSTANCE},,,,,max_connections]</key>
                            <delay>{$DBS_MYSQL_VAR_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.variable_info[{#INSTANCE},table_open_cache]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[variable_info,mysql,{#INSTANCE},,,,,table_open_cache]</key>
                            <delay>{$DBS_MYSQL_VAR_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Status: Log of '{$DBS_MYSQL_LOGDIR:&quot;{#INSTANCE}&quot;}/{$DBS_MYSQL_LOGNAME:&quot;{#INSTANCE}&quot;}'</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>logrt[{$DBS_MYSQL_LOGDIR:&quot;{#INSTANCE}&quot;}/{$DBS_MYSQL_LOGNAME:&quot;{#INSTANCE}&quot;},&quot;PANIC|FATAL|ERROR|[Ee]rror&quot;]</key>
                            <delay>{$DBS_MYSQL_LOG_INFO_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>LOG</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Info</name>
                                </application_prototype>
                            </application_prototypes>
                            <logtimefmt>yyyy-MM-ddThh:mm:ss</logtimefmt>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{iregexp(&quot;InnoDB&quot;)}=1</expression>
                                    <name>{{ITEM.VALUE}.iregsub(&quot;InnoDB: ([a-zA-Z0-9 &gt;]+)&quot;, &quot;Fatal error in MySQL InnoDB (Error: '\1')&quot;)}</name>
                                    <priority>HIGH</priority>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Instance '{#INSTANCE}' is not available.</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_connected].avg(3m)}/{DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}*100&gt;{$DBS_MYSQL_CONNECTION_PRC_WARN:&quot;{#INSTANCE}&quot;} and {DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}&gt;0</expression>
                            <name>Too many connections</name>
                            <opdata>(current: {ITEM.LASTVALUE1}, max: {ITEM.LASTVALUE2}, alert started {ITEM.VALUE1})</opdata>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>Instance '{#INSTANCE}' is not available.</name>
                                    <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                    <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                </dependency>
                                <dependency>
                                    <name>Too many connections</name>
                                    <expression>{DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_connected].avg(5m)}/{DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}*100&gt;{$DBS_MYSQL_CONNECTION_PRC_CRIT:&quot;{#INSTANCE}&quot;} and {DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}&gt;0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_connected].avg(5m)}/{DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}*100&gt;{$DBS_MYSQL_CONNECTION_PRC_CRIT:&quot;{#INSTANCE}&quot;} and {DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}&gt;0</expression>
                            <name>Too many connections</name>
                            <opdata>(current: {ITEM.LASTVALUE1}, max: {ITEM.LASTVALUE2}, alert started {ITEM.VALUE1})</opdata>
                            <priority>HIGH</priority>
                            <dependencies>
                                <dependency>
                                    <name>Instance '{#INSTANCE}' is not available.</name>
                                    <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                    <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_running].avg(3m)}/{DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}*100&gt;{$DBS_MYSQL_THREADS_RUNNING_PRC_WARN:&quot;{#INSTANCE}&quot;} and {DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}&gt;0 and {DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_connected].last()}&gt;0</expression>
                            <name>Too many threads running</name>
                            <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_THREADS_WARN:&quot;{#INSTANCE}&quot;}, alert started {ITEM.VALUE1})</opdata>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>Instance '{#INSTANCE}' is not available.</name>
                                    <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                    <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                </dependency>
                                <dependency>
                                    <name>Too many threads running</name>
                                    <expression>{DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_running].avg(5m)}/{DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}*100&gt;{$DBS_MYSQL_THREADS_RUNNING_PRC_CRIT:&quot;{#INSTANCE}&quot;} and {DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}&gt;0 and {DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_connected].last()}&gt;0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_running].avg(5m)}/{DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}*100&gt;{$DBS_MYSQL_THREADS_RUNNING_PRC_CRIT:&quot;{#INSTANCE}&quot;} and {DBS_Template MySQL:dbs.mysql.variable[{#INSTANCE},max_connections].last()}&gt;0 and {DBS_Template MySQL:dbs.mysql.status[{#INSTANCE},threads_connected].last()}&gt;0</expression>
                            <name>Too many threads running</name>
                            <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_THREADS_CRIT:&quot;{#INSTANCE}&quot;}, alert started {ITEM.VALUE1})</opdata>
                            <priority>HIGH</priority>
                            <dependencies>
                                <dependency>
                                    <name>Instance '{#INSTANCE}' is not available.</name>
                                    <expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=0 or {DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].nodata({$DBS_MYSQL_INSTANCE_NODATA_CRIT:&quot;{#INSTANCE}&quot;})}=1</expression>
                                    <recovery_expression>{DBS_Template MySQL:dbs.mysql.instance[{#INSTANCE},status].last()}=1</recovery_expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>[MySQL] Open tables on instance {#INSTANCE}</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.status[{#INSTANCE},open_tables]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <drawtype>BOLD_LINE</drawtype>
                                    <color>F63100</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.variable[{#INSTANCE},table_open_cache]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                        <graph_prototype>
                            <name>[MySQL] Threads on instance {#INSTANCE}</name>
                            <ymax_type_1>ITEM</ymax_type_1>
                            <ymax_item_1>
                                <host>DBS_Template MySQL</host>
                                <key>dbs.mysql.variable[{#INSTANCE},max_connections]</key>
                            </ymax_item_1>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.status[{#INSTANCE},threads_cached]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>1</sortorder>
                                    <color>F63100</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.status[{#INSTANCE},threads_connected]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>2</sortorder>
                                    <color>0000EE</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.status[{#INSTANCE},threads_running]</key>
                                    </item>
                                </graph_item>
                                <graph_item>
                                    <sortorder>3</sortorder>
                                    <drawtype>BOLD_LINE</drawtype>
                                    <color>A54F10</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.variable[{#INSTANCE},max_connections]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>MySQL slave discovery</name>
                    <type>ZABBIX_ACTIVE</type>
                    <key>dbs.runshell[slave_discovery,mysql]</key>
                    <delay>{$DBS_MYSQL_LLD_SLAVE_TIME}</delay>
                    <item_prototypes>
                        <item_prototype>
                            <name>[MySQL] Replication: Executed_Gtid_Set</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Executed_Gtid_Set]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_SHORT_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Last_IO_Errno</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Last_IO_Errno]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Last_IO_Error</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Last_IO_Error]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Last_SQL_Errno</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Last_SQL_Errno]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Last_SQL_Error</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Last_SQL_Error]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Retrieved_Gtid_Set</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Retrieved_Gtid_Set]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_SHORT_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Seconds_Behind_Master</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Seconds_Behind_Master]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>s</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg(10m)}&gt;{$DBS_MYSQL_APPLY_LAG_CRIT:&quot;{#INSTANCE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{min(5m)}&lt;={$DBS_MYSQL_APPLY_LAG_CRIT:&quot;{#INSTANCE}&quot;}</recovery_expression>
                                    <name>Replication lag is too high</name>
                                    <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_APPLY_LAG_CRIT:&quot;{#INSTANCE}&quot;}, alert started: {ITEM.VALUE1})</opdata>
                                    <priority>HIGH</priority>
                                    <description>Очень высокое отставание slave реплики. Проверьте состояние с помощью команды &quot;SHOW SLAVE STATUS\G&quot;. Сообщите о проблеме эксперту.</description>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg(10m)}&gt;{$DBS_MYSQL_APPLY_LAG_WARN:&quot;{#INSTANCE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{min(5m)}&lt;={$DBS_MYSQL_APPLY_LAG_WARN:&quot;{#INSTANCE}&quot;}</recovery_expression>
                                    <name>Replication lag is too high</name>
                                    <opdata>(current: {ITEM.LASTVALUE1}, threshold: {$DBS_MYSQL_APPLY_LAG_WARN:&quot;{#INSTANCE}&quot;}, alert started: {ITEM.VALUE1})</opdata>
                                    <priority>WARNING</priority>
                                    <description>Высокое отставание slave реплики. Проверьте состояние с помощью команды &quot;SHOW SLAVE STATUS\G&quot;. Сообщите о проблеме эксперту.</description>
                                    <dependencies>
                                        <dependency>
                                            <name>Replication lag is too high</name>
                                            <expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Seconds_Behind_Master].avg(10m)}&gt;{$DBS_MYSQL_APPLY_LAG_CRIT:&quot;{#INSTANCE}&quot;}</expression>
                                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Seconds_Behind_Master].min(5m)}&lt;={$DBS_MYSQL_APPLY_LAG_CRIT:&quot;{#INSTANCE}&quot;}</recovery_expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Slave_IO_Running</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Slave_IO_Running]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <valuemap>
                                <name>DBS MySQL (Replication slave IO state)</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication: Slave_SQL_Running</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.replication[{#INSTANCE},Slave_SQL_Running]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication</name>
                                </application_prototype>
                            </application_prototypes>
                            <valuemap>
                                <name>DBS MySQL (Replication slave SQL state)</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Binary log format</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},binlog_format]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (binlog_format) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Binary log row image</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},binlog_row_image]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (binlog_row_image) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Enforce GTID consistency</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},enforce_gtid_consistency]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (enforce_gtid_consistency) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: GTID mode</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},gtid_mode]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (gtid_mode) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Log bin</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},log_bin]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (log_bin) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Max binlog size</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},max_binlog_size]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_MEDIUM_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Server ID</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},server_id]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (server_id) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Slave parallel type</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},slave_parallel_type]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{diff()}&gt;0</expression>
                                    <recovery_mode>NONE</recovery_mode>
                                    <name>Replication settings (slave_parallel_type) has been changed</name>
                                    <opdata>(current: {ITEM.VALUE})</opdata>
                                    <priority>INFO</priority>
                                    <type>MULTIPLE</type>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>DBType</tag>
                                            <value>MySQL</value>
                                        </tag>
                                        <tag>
                                            <tag>Instance</tag>
                                            <value>{#INSTANCE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Slave parallel workers</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},slave_parallel_workers]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Slave pending jobs size max</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},slave_pending_jobs_size_max]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_LONG_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>{$DBS_MYSQL_LONG_TRENDS:&quot;{#INSTANCE}&quot;}</trends>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>[MySQL] Replication settings: Slave preserve commit order</name>
                            <type>TRAP</type>
                            <key>dbs.mysql.variable[{#INSTANCE},slave_preserve_commit_order]</key>
                            <delay>0</delay>
                            <history>{$DBS_MYSQL_MEDIUM_HISTORY:&quot;{#INSTANCE}&quot;}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <application_prototypes>
                                <application_prototype>
                                    <name>MySQL: Instance: {#INSTANCE}, Replication settings</name>
                                </application_prototype>
                            </application_prototypes>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.replication_settings[{#INSTANCE},full]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[replication_settings,mysql,{#INSTANCE}]</key>
                            <delay>{$DBS_MYSQL_REPL_SETTINGS_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>dbs_zbx_mon.slave_info[{#INSTANCE},full]</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>dbs.runshell[slave_info,mysql,{#INSTANCE}]</key>
                            <delay>{$DBS_MYSQL_SLAVE_STATUS_TIME:&quot;{#INSTANCE}&quot;}</delay>
                            <history>{$DBS_MYSQL_STUBS_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <applications>
                                <application>
                                    <name>stubs</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_IO_Running].last()}&lt;&gt;1 and {DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Last_IO_Errno].last()}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_IO_Running].last()}=1</recovery_expression>
                            <name>Replication process is stopped (IO thread not running)</name>
                            <priority>WARNING</priority>
                            <description>Репликация остановлена (IO thread) в ручном режиме, возможно для выполнения каких-то работ. Проверьте состояние ошибок репликации с помощью команды &quot;SHOW SLAVE STATUS\G&quot;.</description>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_SQL_Running].last()}&lt;&gt;1 and {DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Last_SQL_Errno].last()}=0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_SQL_Running].last()}=1</recovery_expression>
                            <name>Replication process is stopped (SQL thread not running)</name>
                            <priority>WARNING</priority>
                            <description>Репликация остановлена (SQL thread) в ручном режиме, возможно для выполнения каких-то работ. Проверьте состояние ошибок репликации с помощью команды &quot;SHOW SLAVE STATUS\G&quot;.</description>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_IO_Running].last()}&lt;&gt;1 and {DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Last_IO_Errno].last()}&lt;&gt;0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_IO_Running].last()}=1</recovery_expression>
                            <name>Replication process is stopped due to an error (IO thread not running)</name>
                            <priority>HIGH</priority>
                            <description>Репликация остановлена (IO thread) в результате критической ошибки. Проверьте состояние ошибок репликации с помощью команды &quot;SHOW SLAVE STATUS\G&quot;. Сообщите о проблеме эксперту.</description>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_SQL_Running].last()}&lt;&gt;1 and {DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Last_SQL_Errno].last()}&lt;&gt;0</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{DBS_Template MySQL:dbs.mysql.replication[{#INSTANCE},Slave_SQL_Running].last()}=1</recovery_expression>
                            <name>Replication process is stopped due to an error (SQL thread not running)</name>
                            <priority>HIGH</priority>
                            <description>Репликация остановлена (SQL thread) в результате критической ошибки. Проверьте состояние ошибок репликации с помощью команды &quot;SHOW SLAVE STATUS\G&quot;. Сообщите о проблеме эксперту.</description>
                            <tags>
                                <tag>
                                    <tag>DBType</tag>
                                    <value>MySQL</value>
                                </tag>
                                <tag>
                                    <tag>Instance</tag>
                                    <value>{#INSTANCE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>[MySQL] Replication lag on instance {#INSTANCE}</name>
                            <graph_items>
                                <graph_item>
                                    <color>EE0000</color>
                                    <item>
                                        <host>DBS_Template MySQL</host>
                                        <key>dbs.mysql.replication[{#INSTANCE},Seconds_Behind_Master]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$DBS_CONF_FILE_DIR}</macro>
                    <value>/var/lib/zabbix</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_AGENTD_NODATA_CRIT}</macro>
                    <value>10m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_AGENTD_NODATA_WARN}</macro>
                    <value>3m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_APPLY_LAG_CRIT}</macro>
                    <value>2h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_APPLY_LAG_WARN}</macro>
                    <value>1h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_BACKUP_INFO_TIME}</macro>
                    <value>1h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_CONNECTION_PRC_CRIT}</macro>
                    <value>95</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_CONNECTION_PRC_WARN}</macro>
                    <value>85</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DBSIZE_CRIT}</macro>
                    <value>7G</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DBSIZE_DISAS}</macro>
                    <value>10G</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DBSIZE_INFO_TIME}</macro>
                    <value>30m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DBSIZE_TOTAL_WARN}</macro>
                    <value>50G</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DBSIZE_WARN}</macro>
                    <value>5G</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DB_INFO_TIME}</macro>
                    <value>2m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DB_NODATA_CRIT}</macro>
                    <value>15m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_DB_NODATA_WARN}</macro>
                    <value>5m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_FULL_BACKUP_CRIT}</macro>
                    <value>10d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_FULL_BACKUP_WARN}</macro>
                    <value>8d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_HEARTBEAT_CHECK_TIME}</macro>
                    <value>1m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_INSTANCE_INFO_TIME}</macro>
                    <value>1m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_INSTANCE_NODATA_CRIT}</macro>
                    <value>7m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LLD_DB_TIME}</macro>
                    <value>45m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LLD_INSTANCE_TIME}</macro>
                    <value>55h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LLD_SLAVE_TIME}</macro>
                    <value>50m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LOGDIR}</macro>
                    <value>/var/log/mysql</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LOGNAME}</macro>
                    <value>error.log</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LOG_INFO_TIME}</macro>
                    <value>1m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LONG_HISTORY}</macro>
                    <value>30d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_LONG_TRENDS}</macro>
                    <value>365d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_MAX_RUNNING_DBS_SCRIPT}</macro>
                    <value>15</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_MEDIUM_HISTORY}</macro>
                    <value>10d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_MEDIUM_TRENDS}</macro>
                    <value>180d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_REPL_SETTINGS_TIME}</macro>
                    <value>1h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_SHORT_HISTORY}</macro>
                    <value>1d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_SHORT_TRENDS}</macro>
                    <value>90d</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_SLAVE_STATUS_TIME}</macro>
                    <value>1m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_STATUS_INFO_TIME}</macro>
                    <value>5m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_STUBS_HISTORY}</macro>
                    <value>1h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_THREADS_INFO_TIME}</macro>
                    <value>1m</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_THREADS_RUNNING_PRC_CRIT}</macro>
                    <value>90</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_THREADS_RUNNING_PRC_WARN}</macro>
                    <value>80</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_VAR_INFO_TIME}</macro>
                    <value>1h</value>
                </macro>
                <macro>
                    <macro>{$DBS_MYSQL_ZABBIX_CHECK_TIME}</macro>
                    <value>5m</value>
                </macro>
            </macros>
        </template>
    </templates>
    <triggers>
        <trigger>
            <expression>{DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,script_version].diff()}=1 and {DBS_Template MySQL:dbs.runshell[dbs_heartbeat,mysql,script_crc].diff()}=1</expression>
            <recovery_mode>NONE</recovery_mode>
            <name>DBS script has been automatic updated.</name>
            <priority>INFO</priority>
            <description>Произошло обновление скриптов мониторинга в автоматическом режиме. Уточнить в дежурном чате про наличие заданий на автоматическое обновление скриптов мониторинга.</description>
            <type>MULTIPLE</type>
            <manual_close>YES</manual_close>
            <tags>
                <tag>
                    <tag>Service</tag>
                    <value>DBS-MySQL-Heartbeat</value>
                </tag>
            </tags>
        </trigger>
    </triggers>
    <value_maps>
        <value_map>
            <name>DBS MySQL (Database access state)</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>FAILED</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>SUCCESSFUL</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>NOTFOUND</newvalue>
                </mapping>
                <mapping>
                    <value>3</value>
                    <newvalue>OFFLINE</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>DBS MySQL (Instance state)</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>STOPPED</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>RUNNING</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>RUNNING_BACKUPING</newvalue>
                </mapping>
                <mapping>
                    <value>3</value>
                    <newvalue>RESTORING</newvalue>
                </mapping>
                <mapping>
                    <value>4</value>
                    <newvalue>ERROR</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>DBS MySQL (Replication slave IO state)</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>NO</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>YES</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>CONNECTING</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>DBS MySQL (Replication slave SQL state)</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>NO</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>YES</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>DBS Oracle Script (yes_no)</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>No</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>Yes</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>DBS Zabbix Agent status</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>Down</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>Up</newvalue>
                </mapping>
            </mappings>
        </value_map>
    </value_maps>
</zabbix_export>
